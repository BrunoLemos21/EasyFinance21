document.getElementById("formSimulador").addEventListener("submit", function (e) {
  e.preventDefault();

  const inicial = parseFloat(document.getElementById("inicial").value);
  const aporte = parseFloat(document.getElementById("aporte").value);
  const taxa = parseFloat(document.getElementById("taxa").value) / 100;
  const meses = parseInt(document.getElementById("periodo").value);
  const inflacao = parseFloat(document.getElementById("inflacao").value) / 100;

  let comAportes = [];
  let semAportes = [];
  let comAportesReal = [];
  let semAportesReal = [];

  let valorComAporte = inicial;
  let valorSemAporte = inicial;

  for (let i = 1; i <= meses; i++) {
    // Juros
    valorComAporte = (valorComAporte + aporte) * (1 + taxa);
    valorSemAporte = valorSemAporte * (1 + taxa);

    // Corrige pela inflação: valor / (1 + inflação)
    const valorComAporteReal = valorComAporte / Math.pow(1 + inflacao, i);
    const valorSemAporteReal = valorSemAporte / Math.pow(1 + inflacao, i);

    comAportes.push(valorComAporteReal);
    semAportes.push(valorSemAporteReal);
  }

  const tabela = document.getElementById("tabelaResultado");
  tabela.innerHTML = "";
  for (let i = 0; i < meses; i++) {
    const row = `<tr>
      <td>${i + 1}</td>
      <td>R$ ${comAportes[i].toFixed(2)}</td>
      <td>R$ ${semAportes[i].toFixed(2)}</td>
      <td>${(inflacao * 100).toFixed(1)}%</td>
    </tr>`;
    tabela.innerHTML += row;
  }

  // Gráfico
  const ctx = document.getElementById("graficoSimulador").getContext("2d");
  if (window.graficoInvestimento) window.graficoInvestimento.destroy();
  window.graficoInvestimento = new Chart(ctx, {
    type: "line",
    data: {
      labels: Array.from({ length: meses }, (_, i) => `M${i + 1}`),
      datasets: [
        {
          label: "Com Aportes (corrigido)",
          data: comAportes,
          borderColor: "#0b515a",
          fill: false,
        },
        {
          label: "Sem Aportes (corrigido)",
          data: semAportes,
          borderColor: "#aaa",
          fill: false,
        },
      ],
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });
});
